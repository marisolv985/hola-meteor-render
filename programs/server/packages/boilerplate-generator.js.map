{"version":3,"sources":["meteor://ðŸ’»app/packages/boilerplate-generator/generator.js","meteor://ðŸ’»app/packages/boilerplate-generator/template-web.browser.js","meteor://ðŸ’»app/packages/boilerplate-generator/template-web.cordova.js","meteor://ðŸ’»app/packages/boilerplate-generator/template.js"],"names":["readUtf8FileSync","filename","readFileSync","identity","value","appendToStream","chunk","stream","append","Buffer","from","isBuffer","read","Boilerplate","toHTML","extraData","Error","toHTMLAsync","Promise","resolve","reject","toHTMLStream","chunks","on","push","concat","toString","baseData","headTemplate","closeTemplate","data","start","body","dynamicBody","end","response","createStream","_generateBoilerplateFromManifest","manifest","urlMapper","pathMapper","baseDataExtension","inline","boilerplateBaseData","css","js","head","meteorManifest","JSON","stringify","forEach","item","urlPath","url","itemObj","scriptContent","path","sri","type","where","startsWith","arch","options","getTemplate","prefix","split","join","modernHeadTemplate","modernCloseTemplate","cordovaHeadTemplate","cordovaCloseTemplate","template","mode","htmlAttributes","bundledJsCssUrlRewriteHook","sriMode","dynamicHead","headSections","cssBundle","map","file","href","Object","keys","key","attrName","attrValue","length","meteorRuntimeConfig","meteorRuntimeHash","rootUrlPathPrefix","inlineScriptsAllowed","additionalStaticJs","conf","src","hash","contents","pathname","reEmptyStringLeading","reEmptyStringMiddle","reEmptyStringTrailing","reEscape","reEvaluate","reInterpolate","reEsTemplate","reUnescapedString","htmlEscapes","reHasUnescapedHtml","escapeHtml","string","test","replace","chr","escapes","escapeStringChar","match","isObject","toStringSafe","baseValues","object","props","k","attempt","fn","e","isError","name","templateCounter","_template","imports","escape","importKeys","importValues","index","isEscaping","isEvaluating","source","reDelimiters","RegExp","sourceURL","escapeValue","interpolateValue","esTemplateValue","evaluateValue","offset","slice","result","Function","apply","undefined","text"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAgC;AAC0B;AAEwD;AACE;AAEpH,4BAA4B;AAC5B,MAAMA,mBAAmBC,YAAYC,aAAaD,UAAU;AAE5D,MAAME,WAAWC,SAASA;AAE1B,SAASC,eAAeC,KAAK,EAAEC,MAAM;IACnC,IAAI,OAAOD,UAAU,UAAU;QAC7BC,OAAOC,MAAM,CAACC,OAAOC,IAAI,CAACJ,OAAO;IACnC,OAAO,IAAIG,OAAOE,QAAQ,CAACL,UAChB,OAAOA,MAAMM,IAAI,KAAK,YAAY;QAC3CL,OAAOC,MAAM,CAACF;IAChB;AACF;AAEA,OAAO,MAAMO;IAaXC,OAAOC,SAAS,EAAE;QAChB,MAAM,IAAIC,MACR,qDACE;IAEN;IAEA,uDAAuD;IACvDC,YAAYF,SAAS,EAAE;QACrB,OAAO,IAAIG,QAAQ,CAACC,SAASC;YAC3B,MAAMb,SAAS,IAAI,CAACc,YAAY,CAACN;YACjC,MAAMO,SAAS,EAAE;YACjBf,OAAOgB,EAAE,CAAC,QAAQjB,SAASgB,OAAOE,IAAI,CAAClB;YACvCC,OAAOgB,EAAE,CAAC,OAAO;gBACfJ,QAAQV,OAAOgB,MAAM,CAACH,QAAQI,QAAQ,CAAC;YACzC;YACAnB,OAAOgB,EAAE,CAAC,SAASH;QACrB;IACF;IAEA,sEAAsE;IACtE,qEAAqE;IACrE,uEAAuE;IACvE,mEAAmE;IACnE,wBAAwB;IACxBC,aAAaN,SAAS,EAAE;QACtB,IAAI,CAAC,IAAI,CAACY,QAAQ,IAAI,CAAC,IAAI,CAACC,YAAY,IAAI,CAAC,IAAI,CAACC,aAAa,EAAE;YAC/D,MAAM,IAAIb,MAAM;QAClB;QAEA,MAAMc,OAAO,mBAAI,IAAI,CAACH,QAAQ,EAAKZ;QACnC,MAAMgB,QAAQ,sBAAsB,IAAI,CAACH,YAAY,CAACE;QAEtD,MAAM,EAAEE,IAAI,EAAEC,WAAW,EAAE,GAAGH;QAE9B,MAAMI,MAAM,IAAI,CAACL,aAAa,CAACC;QAC/B,MAAMK,WAAWC;QAEjB/B,eAAe0B,OAAOI;QAEtB,IAAIH,MAAM;YACR3B,eAAe2B,MAAMG;QACvB;QAEA,IAAIF,aAAa;YACf5B,eAAe4B,aAAaE;QAC9B;QAEA9B,eAAe6B,KAAKC;QAEpB,OAAOA;IACT;IAEA,4EAA4E;IAC5E,2CAA2C;IAC3C,qEAAqE;IACrE,4EAA4E;IAC5E,gBAAgB;IAChB,wEAAwE;IACxE,4DAA4D;IAC5DE,iCAAiCC,QAAQ,EAAE,EACzCC,YAAYpC,QAAQ,EACpBqC,aAAarC,QAAQ,EACrBsC,iBAAiB,EACjBC,MAAM,EACP,GAAG,CAAC,CAAC,EAAE;QAEN,MAAMC,sBAAsB;YAC1BC,KAAK,EAAE;YACPC,IAAI,EAAE;YACNC,MAAM;YACNd,MAAM;YACNe,gBAAgBC,KAAKC,SAAS,CAACX;WAC5BG;QAGLH,SAASY,OAAO,CAACC;YACf,MAAMC,UAAUb,UAAUY,KAAKE,GAAG;YAClC,MAAMC,UAAU;gBAAED,KAAKD;YAAQ;YAE/B,IAAIV,QAAQ;gBACVY,QAAQC,aAAa,GAAGvD,iBACtBwC,WAAWW,KAAKK,IAAI;gBACtBF,QAAQZ,MAAM,GAAG;YACnB,OAAO,IAAIS,KAAKM,GAAG,EAAE;gBACnBH,QAAQG,GAAG,GAAGN,KAAKM,GAAG;YACxB;YAEA,IAAIN,KAAKO,IAAI,KAAK,SAASP,KAAKQ,KAAK,KAAK,UAAU;gBAClDhB,oBAAoBC,GAAG,CAACpB,IAAI,CAAC8B;YAC/B;YAEA,IAAIH,KAAKO,IAAI,KAAK,QAAQP,KAAKQ,KAAK,KAAK,YACvC,yDAAyD;YACzD,2BAA2B;YAC3B,CAACR,KAAKK,IAAI,CAACI,UAAU,CAAC,aAAa;gBACnCjB,oBAAoBE,EAAE,CAACrB,IAAI,CAAC8B;YAC9B;YAEA,IAAIH,KAAKO,IAAI,KAAK,QAAQ;gBACxBf,oBAAoBG,IAAI,GACtB9C,iBAAiBwC,WAAWW,KAAKK,IAAI;YACzC;YAEA,IAAIL,KAAKO,IAAI,KAAK,QAAQ;gBACxBf,oBAAoBX,IAAI,GACtBhC,iBAAiBwC,WAAWW,KAAKK,IAAI;YACzC;QACF;QAEA,IAAI,CAAC7B,QAAQ,GAAGgB;IAClB;IA3HA,YAAYkB,IAAI,EAAEvB,QAAQ,EAAEwB,UAAU,CAAC,CAAC,CAAE;QACxC,MAAM,EAAElC,YAAY,EAAEC,aAAa,EAAE,GAAGkC,YAAYF;QACpD,IAAI,CAACjC,YAAY,GAAGA;QACpB,IAAI,CAACC,aAAa,GAAGA;QACrB,IAAI,CAACF,QAAQ,GAAG;QAEhB,IAAI,CAACU,gCAAgC,CACnCC,UACAwB;IAEJ;AAkHF;;AAEA,0EAA0E;AAC1E,oBAAoB;AACpB,SAASC,YAAYF,IAAI;IACvB,MAAMG,SAASH,KAAKI,KAAK,CAAC,KAAK,GAAGC,IAAI,CAAC;IAEvC,IAAIF,WAAW,eAAe;QAC5B,OAAO;YAAEpC,cAAcuC;YAAoBtC,eAAeuC;QAAoB;IAChF;IAEA,IAAIJ,WAAW,eAAe;QAC5B,OAAO;YAAEpC,cAAcyC;YAAqBxC,eAAeyC;QAAqB;IAClF;IAEA,MAAM,IAAItD,MAAM,uBAAuB6C;AACzC;;;;;;;;;;;;;ACjKA,OAAOU,cAAc,aAAa;AAElC,MAAMd,MAAM,CAACA,KAAKe,OACff,OAAOe,OAAQ,CAAC,mBAAmB,EAAEf,IAAI,eAAe,EAAEe,KAAK,CAAC,CAAC,GAAG;AAEvE,OAAO,MAAM5C,eAAe,CAAC,EAC3BgB,GAAG,EACH6B,cAAc,EACdC,0BAA0B,EAC1BC,OAAO,EACP7B,IAAI,EACJ8B,UACD;IACC,IAAIC,eAAe/B,KAAKmB,KAAK,CAAC,8BAA8B;IAC5D,IAAIa,YAAY;WAAKlC,QAAO,EAAE,EAAEmC,GAAG,CAACC,QAClCT,SAAS,iGAAiG;gBACxGU,MAAMP,2BAA2BM,KAAK3B,GAAG;gBACzCI,KAAKA,IAAIuB,KAAKvB,GAAG,EAAEkB;YACrB;KACA,CAACT,IAAI,CAAC;IAER,OAAO;QACL,UAAUgB,OAAOC,IAAI,CAACV,kBAAkB,CAAC,GAAGM,GAAG,CAC7CK,OAAOb,SAAS,uCAAuC;gBACrDc,UAAUD;gBACVE,WAAWb,cAAc,CAACW,IAAI;YAChC,IACAlB,IAAI,CAAC,MAAM;QAEb;QAECW,aAAaU,MAAM,KAAK,IACrB;YAACT;YAAWD,YAAY,CAAC,EAAE;SAAC,CAACX,IAAI,CAAC,QAClC;YAACW,YAAY,CAAC,EAAE;YAAEC;YAAWD,YAAY,CAAC,EAAE;SAAC,CAACX,IAAI,CAAC;QAEvDU;QACA;QACA;KACD,CAACV,IAAI,CAAC;AACT,EAAE;AAEF,oEAAoE;AACpE,OAAO,MAAMrC,gBAAgB,CAAC,EAC5B2D,mBAAmB,EACnBC,iBAAiB,EACjBC,iBAAiB,EACjBC,oBAAoB,EACpB9C,EAAE,EACF+C,kBAAkB,EAClBlB,0BAA0B,EAC1BC,MACI;QACJ;QACAgB,uBACIpB,SAAS,qHAAqH;YAC9HsB,MAAML;QACR,KACEjB,SAAS,yGAAyG;YAClHuB,KAAKJ;YACLK,MAAMN;QACR;QACF;WAEI5C,OAAM,EAAE,EAAEkC,GAAG,CAACC,QAChBT,SAAS,yEAAyE;gBAChFuB,KAAKpB,2BAA2BM,KAAK3B,GAAG;gBACxCI,KAAKA,IAAIuB,KAAKvB,GAAG,EAAEkB;YACrB;WAGEiB,uBAAsB,EAAE,EAAEb,GAAG,CAAC,CAAC,EAAEiB,QAAQ,EAAEC,QAAQ,EAAE,GACvDN,uBACIpB,SAAS,sCAAsC;gBAC/CyB;YACF,KACEzB,SAAS,+DAA+D;gBACxEuB,KAAKJ,oBAAoBO;YAC3B;QAGJ;QACA;QACA;QACA;KACD,CAAC/B,IAAI,CAAC,MAAM;;;;;;;;;;;;;ACpFb,OAAOK,cAAc,aAAa;AAElC,mEAAmE;AACnE,OAAO,MAAM3C,eAAe,CAAC,EAC3B4D,mBAAmB,EACnBE,iBAAiB,EACjBC,oBAAoB,EACpB/C,GAAG,EACHC,EAAE,EACF+C,kBAAkB,EAClBnB,cAAc,EACdC,0BAA0B,EAC1B5B,IAAI,EACJ8B,UACD;IACC,IAAIC,eAAe/B,KAAKmB,KAAK,CAAC,8BAA8B;IAC5D,IAAIa,YAAY;QACd,qJAAqJ;WACjJlC,QAAO,EAAE,EAAEmC,GAAG,CAACC,QACjBT,SAAS,uFAAuF;gBAC9FU,MAAMD,KAAK3B,GAAG;YAChB;KACF,CAACa,IAAI,CAAC;IAER,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QAEDW,aAAaU,MAAM,KAAK,IACrB;YAACT;YAAWD,YAAY,CAAC,EAAE;SAAC,CAACX,IAAI,CAAC,QAClC;YAACW,YAAY,CAAC,EAAE;YAAEC;YAAWD,YAAY,CAAC,EAAE;SAAC,CAACX,IAAI,CAAC;QAErD;QACAK,SAAS,gFAAgF;YACvFsB,MAAML;QACR;QACA;QACA,gEAAgE;QAChE,wCAAwC;QACxC,sDAAsD;QACtD;QACA;QACA;QACA;QACA;QACA;QACA;QACA;WAEI3C,OAAM,EAAE,EAAEkC,GAAG,CAACC,QAChBT,SAAS,+DAA+D;gBACtEuB,KAAKd,KAAK3B,GAAG;YACf;WAGEuC,uBAAsB,EAAE,EAAEb,GAAG,CAAC,CAAC,EAAEiB,QAAQ,EAAEC,QAAQ,EAAE,GACvDN,uBACIpB,SAAS,sCAAsC;gBAC/CyB;YACF,KACEzB,SAAS,+DAA+D;gBACxEuB,KAAKJ,oBAAoBO;YAC3B;QAEJ;QACA;QACA;QACA;KACD,CAAC/B,IAAI,CAAC;AACT,EAAE;AAEF,OAAO,SAASrC;IACd,OAAO;AACT;;;;;;;;;;;;;AC9EA;;;;;;CAMC,GAED,8EAA8E;AAC9E,yEAAyE;AACzE,8EAA8E;AAE9E,MAAMqE,uBAAuB;AAC7B,MAAMC,sBAAsB;AAC5B,MAAMC,wBAAwB;AAE9B,MAAMC,WAAW,oBAAiC,mBAAmB;AACrE,MAAMC,aAAa,mBAAgC,qBAAqB;AACxE,MAAMC,gBAAgB,oBAA6B,wBAAwB;AAC3E,MAAMC,eAAe,mCAAmC,+BAA+B;AACvF,MAAMC,oBAAoB,0BAA0B,yBAAyB;AAE7E,cAAc;AACd,MAAMC,cAAc;IAAE,KAAK;IAAS,KAAK;IAAQ,KAAK;IAAQ,KAAK;IAAU,KAAK;AAAQ;AAC1F,MAAMC,qBAAqB;AAE3B,SAASC,WAAWC,MAAM;IACxB,OAAOA,UAAUF,mBAAmBG,IAAI,CAACD,UACrCA,OAAOE,OAAO,CAAC,YAAYC,OAAON,WAAW,CAACM,IAAI,IACjDH,UAAU;AACjB;AAEA,wDAAwD;AACxD,MAAMI,UAAU;IAAE,KAAK;IAAK,MAAM;IAAM,MAAM;IAAK,MAAM;IAAK,UAAU;IAAS,UAAU;AAAQ;AACnG,SAASC,iBAAiBC,KAAK;IAAI,OAAO,OAAOF,OAAO,CAACE,MAAM;AAAE;AAEjE,8EAA8E;AAC9E,SAASC,SAAShH,KAAK;IAAI,OAAOA,SAAS,QAAQ,OAAOA,UAAU;AAAU;AAC9E,SAASiH,aAAajH,KAAK;IAAI,OAAOA,SAAS,OAAO,KAAMA,QAAQ;AAAK;AACzE,SAASkH,WAAWC,MAAM,EAAEC,KAAK;IAAI,OAAOA,MAAMzC,GAAG,CAAC0C,KAAKF,MAAM,CAACE,EAAE;AAAG;AAGvE,SAASC,QAAQC,EAAE;IACjB,IAAI;QAAE,OAAOA;IAAM,EAAE,OAAOC,GAAG;QAAE,OAAOA;IAAG;AAC7C;AACA,SAASC,QAAQzH,KAAK;IAAI,OAAOA,iBAAiBY,SAAUoG,SAAShH,UAAUA,MAAM0H,IAAI,KAAK;AAAU;AAGxG,8EAA8E;AAC9E,+BAA+B;AAC/B,8EAA8E;AAC9E,IAAIC,kBAAkB,CAAC,GAAG,gCAAgC;AAE1D,SAASC,UAAUnB,MAAM;IACvBA,SAASQ,aAAaR;IAEtB,MAAMoB,UAAU;QAAE,KAAK;YAAEC,QAAQtB;QAAW;IAAE;IAC9C,MAAMuB,aAAajD,OAAOC,IAAI,CAAC8C;IAC/B,MAAMG,eAAed,WAAWW,SAASE;IAEzC,IAAIE,QAAQ;IACZ,IAAIC;IACJ,IAAIC;IACJ,IAAIC,SAAS;IAGb,qCAAqC;IACrC,MAAMC,eAAeC,OACnBrC,SAASmC,MAAM,GAAG,MAClBjC,cAAciC,MAAM,GAAG,MACvBhC,aAAagC,MAAM,GAAG,MACtBlC,WAAWkC,MAAM,GAAG,MACpB;IAEF,MAAMG,YAAY,CAAC,qCAAqC,EAAE,EAAEZ,gBAAgB,GAAG,CAAC;IAEhF,WAAW;IACXlB,OAAOE,OAAO,CAAC0B,cAAc,SAAStB,KAAK,EAAEyB,WAAW,EAAEC,gBAAgB,EAAEC,eAAe,EAAEC,aAAa,EAAEC,MAAM;QAChHH,oBAAqBA,oBAAmBC,eAAc;QACtD,6DAA6D;QAC7DN,UAAU3B,OAAOoC,KAAK,CAACZ,OAAOW,QAAQjC,OAAO,CAACN,mBAAmBS;QACjE,IAAI0B,aAAa;YACfN,aAAa;YACbE,UAAU,cAAcI,cAAc;QACxC;QACA,IAAIG,eAAe;YACjBR,eAAe;YACfC,UAAU,SAASO,gBAAgB;QACrC;QACA,IAAIF,kBAAkB;YACpBL,UAAU,mBAAmBK,mBAAmB;QAClD;QACAR,QAAQW,SAAS7B,MAAM5B,MAAM;QAC7B,OAAO4B;IACT;IAEAqB,UAAU;IAEVA,SAAS,mBAAmBA,SAAS;IAErC,oCAAoC;IACpCA,SAAUD,gBAAeC,OAAOzB,OAAO,CAACb,sBAAsB,MAAMsC,MAAK,EACtEzB,OAAO,CAACZ,qBAAqB,MAC7BY,OAAO,CAACX,uBAAuB;IAElC,yBAAyB;IACzBoC,SAAS,sBACP,yBACA,sBACCF,cAAa,qBAAqB,EAAC,IACnCC,gBACG,2FACA,KAAI,IAERC,SACA;IAEF,sBAAsB;IACtB,MAAMU,SAASxB,QAAQ;QACrB,OAAOyB,SAAShB,YAAYQ,YAAY,YAAYH,QAAQY,KAAK,CAACC,WAAWjB,eAAe,kCAAkC;IAChI;IAEA,IAAIP,QAAQqB,SAAS;QACnBA,OAAOV,MAAM,GAAGA,QAAQ,gCAAgC;QACxD,MAAMU;IACR;IACA,yBAAyB;IACzBA,OAAOV,MAAM,GAAGA;IAChB,OAAOU;AACT;AAEA,eAAe,SAAS3E,CAAa;IACnC,OAAOyD,UAAUsB;AACnB","file":"/packages/boilerplate-generator.js","sourcesContent":["import {readFileSync} from 'fs';\nimport { create as createStream } from \"combined-stream2\";\n\nimport { headTemplate as modernHeadTemplate, closeTemplate as modernCloseTemplate } from './template-web.browser';\nimport { headTemplate as cordovaHeadTemplate, closeTemplate as cordovaCloseTemplate } from './template-web.cordova';\n\n// Copied from webapp_server\nconst readUtf8FileSync = filename => readFileSync(filename, 'utf8');\n\nconst identity = value => value;\n\nfunction appendToStream(chunk, stream) {\n  if (typeof chunk === \"string\") {\n    stream.append(Buffer.from(chunk, \"utf8\"));\n  } else if (Buffer.isBuffer(chunk) ||\n             typeof chunk.read === \"function\") {\n    stream.append(chunk);\n  }\n}\n\nexport class Boilerplate {\n  constructor(arch, manifest, options = {}) {\n    const { headTemplate, closeTemplate } = getTemplate(arch);\n    this.headTemplate = headTemplate;\n    this.closeTemplate = closeTemplate;\n    this.baseData = null;\n\n    this._generateBoilerplateFromManifest(\n      manifest,\n      options\n    );\n  }\n\n  toHTML(extraData) {\n    throw new Error(\n      \"The Boilerplate#toHTML method has been removed. \" +\n        \"Please use Boilerplate#toHTMLStream instead.\"\n    );\n  }\n\n  // Returns a Promise that resolves to a string of HTML.\n  toHTMLAsync(extraData) {\n    return new Promise((resolve, reject) => {\n      const stream = this.toHTMLStream(extraData);\n      const chunks = [];\n      stream.on(\"data\", chunk => chunks.push(chunk));\n      stream.on(\"end\", () => {\n        resolve(Buffer.concat(chunks).toString(\"utf8\"));\n      });\n      stream.on(\"error\", reject);\n    });\n  }\n\n  // The 'extraData' argument can be used to extend 'self.baseData'. Its\n  // purpose is to allow you to specify data that you might not know at\n  // the time that you construct the Boilerplate object. (e.g. it is used\n  // by 'webapp' to specify data that is only known at request-time).\n  // this returns a stream\n  toHTMLStream(extraData) {\n    if (!this.baseData || !this.headTemplate || !this.closeTemplate) {\n      throw new Error('Boilerplate did not instantiate correctly.');\n    }\n\n    const data = {...this.baseData, ...extraData};\n    const start = \"<!DOCTYPE html>\\n\" + this.headTemplate(data);\n\n    const { body, dynamicBody } = data;\n\n    const end = this.closeTemplate(data);\n    const response = createStream();\n\n    appendToStream(start, response);\n\n    if (body) {\n      appendToStream(body, response);\n    }\n\n    if (dynamicBody) {\n      appendToStream(dynamicBody, response);\n    }\n\n    appendToStream(end, response);\n\n    return response;\n  }\n\n  // XXX Exported to allow client-side only changes to rebuild the boilerplate\n  // without requiring a full server restart.\n  // Produces an HTML string with given manifest and boilerplateSource.\n  // Optionally takes urlMapper in case urls from manifest need to be prefixed\n  // or rewritten.\n  // Optionally takes pathMapper for resolving relative file system paths.\n  // Optionally allows to override fields of the data context.\n  _generateBoilerplateFromManifest(manifest, {\n    urlMapper = identity,\n    pathMapper = identity,\n    baseDataExtension,\n    inline,\n  } = {}) {\n\n    const boilerplateBaseData = {\n      css: [],\n      js: [],\n      head: '',\n      body: '',\n      meteorManifest: JSON.stringify(manifest),\n      ...baseDataExtension,\n    };\n\n    manifest.forEach(item => {\n      const urlPath = urlMapper(item.url);\n      const itemObj = { url: urlPath };\n\n      if (inline) {\n        itemObj.scriptContent = readUtf8FileSync(\n          pathMapper(item.path));\n        itemObj.inline = true;\n      } else if (item.sri) {\n        itemObj.sri = item.sri;\n      }\n\n      if (item.type === 'css' && item.where === 'client') {\n        boilerplateBaseData.css.push(itemObj);\n      }\n\n      if (item.type === 'js' && item.where === 'client' &&\n        // Dynamic JS modules should not be loaded eagerly in the\n        // initial HTML of the app.\n        !item.path.startsWith('dynamic/')) {\n        boilerplateBaseData.js.push(itemObj);\n      }\n\n      if (item.type === 'head') {\n        boilerplateBaseData.head =\n          readUtf8FileSync(pathMapper(item.path));\n      }\n\n      if (item.type === 'body') {\n        boilerplateBaseData.body =\n          readUtf8FileSync(pathMapper(item.path));\n      }\n    });\n\n    this.baseData = boilerplateBaseData;\n  }\n};\n\n// Returns a template function that, when called, produces the boilerplate\n// html as a string.\nfunction getTemplate(arch) {\n  const prefix = arch.split(\".\", 2).join(\".\");\n\n  if (prefix === \"web.browser\") {\n    return { headTemplate: modernHeadTemplate, closeTemplate: modernCloseTemplate };\n  }\n\n  if (prefix === \"web.cordova\") {\n    return { headTemplate: cordovaHeadTemplate, closeTemplate: cordovaCloseTemplate };\n  }\n\n  throw new Error(\"Unsupported arch: \" + arch);\n}\n","import template from './template';\n\nconst sri = (sri, mode) =>\n  (sri && mode) ? ` integrity=\"sha512-${sri}\" crossorigin=\"${mode}\"` : '';\n\nexport const headTemplate = ({\n  css,\n  htmlAttributes,\n  bundledJsCssUrlRewriteHook,\n  sriMode,\n  head,\n  dynamicHead,\n}) => {\n  var headSections = head.split(/<meteor-bundled-css[^<>]*>/, 2);\n  var cssBundle = [...(css || []).map(file =>\n    template('  <link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"<%- href %>\"<%= sri %>>')({\n      href: bundledJsCssUrlRewriteHook(file.url),\n      sri: sri(file.sri, sriMode),\n    })\n  )].join('\\n');\n\n  return [\n    '<html' + Object.keys(htmlAttributes || {}).map(\n      key => template(' <%= attrName %>=\"<%- attrValue %>\"')({\n        attrName: key,\n        attrValue: htmlAttributes[key],\n      })\n    ).join('') + '>',\n\n    '<head>',\n\n    (headSections.length === 1)\n      ? [cssBundle, headSections[0]].join('\\n')\n      : [headSections[0], cssBundle, headSections[1]].join('\\n'),\n\n    dynamicHead,\n    '</head>',\n    '<body>',\n  ].join('\\n');\n};\n\n// Template function for rendering the boilerplate html for browsers\nexport const closeTemplate = ({\n  meteorRuntimeConfig,\n  meteorRuntimeHash,\n  rootUrlPathPrefix,\n  inlineScriptsAllowed,\n  js,\n  additionalStaticJs,\n  bundledJsCssUrlRewriteHook,\n  sriMode,\n}) => [\n  '',\n  inlineScriptsAllowed\n    ? template('  <script type=\"text/javascript\">__meteor_runtime_config__ = JSON.parse(decodeURIComponent(<%= conf %>))</script>')({\n      conf: meteorRuntimeConfig,\n    })\n    : template('  <script type=\"text/javascript\" src=\"<%- src %>/meteor_runtime_config.js?hash=<%- hash %>\"></script>')({\n      src: rootUrlPathPrefix,\n      hash: meteorRuntimeHash,\n    }),\n  '',\n\n  ...(js || []).map(file =>\n    template('  <script type=\"text/javascript\" src=\"<%- src %>\"<%= sri %>></script>')({\n      src: bundledJsCssUrlRewriteHook(file.url),\n      sri: sri(file.sri, sriMode),\n    })\n  ),\n\n  ...(additionalStaticJs || []).map(({ contents, pathname }) => (\n    inlineScriptsAllowed\n      ? template('  <script><%= contents %></script>')({\n        contents,\n      })\n      : template('  <script type=\"text/javascript\" src=\"<%- src %>\"></script>')({\n        src: rootUrlPathPrefix + pathname,\n      })\n  )),\n\n  '',\n  '',\n  '</body>',\n  '</html>'\n].join('\\n');\n","import template from './template';\n\n// Template function for rendering the boilerplate html for cordova\nexport const headTemplate = ({\n  meteorRuntimeConfig,\n  rootUrlPathPrefix,\n  inlineScriptsAllowed,\n  css,\n  js,\n  additionalStaticJs,\n  htmlAttributes,\n  bundledJsCssUrlRewriteHook,\n  head,\n  dynamicHead,\n}) => {\n  var headSections = head.split(/<meteor-bundled-css[^<>]*>/, 2);\n  var cssBundle = [\n    // We are explicitly not using bundledJsCssUrlRewriteHook: in cordova we serve assets up directly from disk, so rewriting the URL does not make sense\n    ...(css || []).map(file =>\n      template('  <link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"<%- href %>\">')({\n        href: file.url,\n      })\n  )].join('\\n');\n\n  return [\n    '<html>',\n    '<head>',\n    '  <meta charset=\"utf-8\">',\n    '  <meta name=\"format-detection\" content=\"telephone=no\">',\n    '  <meta name=\"viewport\" content=\"user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, viewport-fit=cover\">',\n    '  <meta name=\"msapplication-tap-highlight\" content=\"no\">',\n    '  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src * android-webview-video-poster: gap: data: blob: \\'unsafe-inline\\' \\'unsafe-eval\\' ws: wss:;\">',\n\n  (headSections.length === 1)\n    ? [cssBundle, headSections[0]].join('\\n')\n    : [headSections[0], cssBundle, headSections[1]].join('\\n'),\n\n    '  <script type=\"text/javascript\">',\n    template('    __meteor_runtime_config__ = JSON.parse(decodeURIComponent(<%= conf %>));')({\n      conf: meteorRuntimeConfig,\n    }),\n    '    if (/Android/i.test(navigator.userAgent)) {',\n    // When Android app is emulated, it cannot connect to localhost,\n    // instead it should connect to 10.0.2.2\n    // (unless we\\'re using an http proxy; then it works!)\n    '      if (!__meteor_runtime_config__.httpProxyPort) {',\n    '        __meteor_runtime_config__.ROOT_URL = (__meteor_runtime_config__.ROOT_URL || \\'\\').replace(/localhost/i, \\'10.0.2.2\\');',\n    '        __meteor_runtime_config__.DDP_DEFAULT_CONNECTION_URL = (__meteor_runtime_config__.DDP_DEFAULT_CONNECTION_URL || \\'\\').replace(/localhost/i, \\'10.0.2.2\\');',\n    '      }',\n    '    }',\n    '  </script>',\n    '',\n    '  <script type=\"text/javascript\" src=\"/cordova.js\"></script>',\n\n    ...(js || []).map(file =>\n      template('  <script type=\"text/javascript\" src=\"<%- src %>\"></script>')({\n        src: file.url,\n      })\n    ),\n\n    ...(additionalStaticJs || []).map(({ contents, pathname }) => (\n      inlineScriptsAllowed\n        ? template('  <script><%= contents %></script>')({\n          contents,\n        })\n        : template('  <script type=\"text/javascript\" src=\"<%- src %>\"></script>')({\n          src: rootUrlPathPrefix + pathname\n        })\n    )),\n    '',\n    '</head>',\n    '',\n    '<body>',\n  ].join('\\n');\n};\n\nexport function closeTemplate() {\n  return \"</body>\\n</html>\";\n}\n","/**\n * Internal full-featured implementation of lodash.template (inspired by v4.5.0)\n * embedded to eliminate the external dependency while preserving functionality.\n *\n * MIT License (c) JS Foundation and other contributors <https://js.foundation/>\n * Adapted for Meteor boilerplate-generator (only the pieces required by template were extracted).\n */\n\n// ---------------------------------------------------------------------------\n// Utility & regex definitions (mirroring lodash pieces used by template)\n// ---------------------------------------------------------------------------\n\nconst reEmptyStringLeading = /\\b__p \\+= '';/g;\nconst reEmptyStringMiddle = /\\b(__p \\+=) '' \\+/g;\nconst reEmptyStringTrailing = /(__e\\(.*?\\)|\\b__t\\)) \\+\\n'';/g;\n\nconst reEscape = /<%-([\\s\\S]+?)%>/g;              // escape delimiter\nconst reEvaluate = /<%([\\s\\S]+?)%>/g;              // evaluate delimiter\nconst reInterpolate = /<%=([\\s\\S]+?)%>/g;          // interpolate delimiter\nconst reEsTemplate = /\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g; // ES6 template literal capture\nconst reUnescapedString = /['\\\\\\n\\r\\u2028\\u2029]/g; // string literal escapes\n\n// HTML escape\nconst htmlEscapes = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;' };\nconst reHasUnescapedHtml = /[&<>\"']/;\n\nfunction escapeHtml(string) {\n  return string && reHasUnescapedHtml.test(string)\n    ? string.replace(/[&<>\"']/g, chr => htmlEscapes[chr])\n    : (string || '');\n}\n\n// Escape characters for inclusion into a string literal\nconst escapes = { \"'\": \"'\", '\\\\': '\\\\', '\\n': 'n', '\\r': 'r', '\\u2028': 'u2028', '\\u2029': 'u2029' };\nfunction escapeStringChar(match) { return '\\\\' + escapes[match]; }\n\n// Basic Object helpers ------------------------------------------------------\nfunction isObject(value) { return value != null && typeof value === 'object'; }\nfunction toStringSafe(value) { return value == null ? '' : (value + ''); }\nfunction baseValues(object, props) { return props.map(k => object[k]); }\n\n\nfunction attempt(fn) {\n  try { return fn(); } catch (e) { return e; }\n}\nfunction isError(value) { return value instanceof Error || (isObject(value) && value.name === 'Error'); }\n\n\n// ---------------------------------------------------------------------------\n// Main template implementation\n// ---------------------------------------------------------------------------\nlet templateCounter = -1; // used for sourceURL generation\n\nfunction _template(string) {\n  string = toStringSafe(string);\n\n  const imports = { '_': { escape: escapeHtml } };\n  const importKeys = Object.keys(imports);\n  const importValues = baseValues(imports, importKeys);\n\n  let index = 0;\n  let isEscaping;\n  let isEvaluating;\n  let source = \"__p += '\";\n\n\n  // Build combined regex of delimiters\n  const reDelimiters = RegExp(\n    reEscape.source + '|' +\n    reInterpolate.source + '|' +\n    reEsTemplate.source + '|' +\n    reEvaluate.source + '|$'\n  , 'g');\n\n  const sourceURL = `//# sourceURL=lodash.templateSources[${++templateCounter}]\\n`;\n\n  // Tokenize\n  string.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {\n    interpolateValue || (interpolateValue = esTemplateValue);\n    // Append preceding string portion with escaped literal chars\n    source += string.slice(index, offset).replace(reUnescapedString, escapeStringChar);\n    if (escapeValue) {\n      isEscaping = true;\n      source += \"' +\\n__e(\" + escapeValue + \") +\\n'\";\n    }\n    if (evaluateValue) {\n      isEvaluating = true;\n      source += \"';\\n\" + evaluateValue + \";\\n__p += '\";\n    }\n    if (interpolateValue) {\n      source += \"' +\\n((__t = (\" + interpolateValue + \")) == null ? '' : __t) +\\n'\";\n    }\n    index = offset + match.length;\n    return match;\n  });\n\n  source += \"';\\n\";\n\n  source = 'with (obj) {\\n' + source + '\\n}\\n';\n\n  // Remove unnecessary concatenations\n  source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)\n    .replace(reEmptyStringMiddle, '$1')\n    .replace(reEmptyStringTrailing, '$1;');\n\n  // Frame as function body\n  source = 'function(obj) {\\n' +\n    'obj || (obj = {});\\n' +\n    \"var __t, __p = ''\" +\n    (isEscaping ? ', __e = _.escape' : '') +\n    (isEvaluating\n      ? ', __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, \\'\\') }\\n'\n      : ';\\n'\n    ) +\n    source +\n    'return __p\\n}';\n\n  // Actual compile step\n  const result = attempt(function() {\n    return Function(importKeys, sourceURL + 'return ' + source).apply(undefined, importValues); // eslint-disable-line no-new-func\n  });\n\n  if (isError(result)) {\n    result.source = source; // expose for debugging if error\n    throw result;\n  }\n  // Expose compiled source\n  result.source = source;\n  return result;\n}\n\nexport default function template(text) {\n  return _template(text);\n}\n"]}