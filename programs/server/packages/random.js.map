{"version":3,"sources":["meteor://ðŸ’»app/packages/random/main_server.js","meteor://ðŸ’»app/packages/random/AbstractRandomGenerator.js","meteor://ðŸ’»app/packages/random/AleaRandomGenerator.js","meteor://ðŸ’»app/packages/random/NodeRandomGenerator.js","meteor://ðŸ’»app/packages/random/createAleaGenerator.js","meteor://ðŸ’»app/packages/random/createRandom.js"],"names":["Random","createRandom","NodeRandomGenerator","UNMISTAKABLE_CHARS","BASE64_CHARS","RandomGenerator","fraction","Error","hexString","digits","_randomString","charsCount","alphabet","result","i","choice","id","undefined","secret","arrayOrString","index","Math","floor","length","substr","Alea","seeds","Mash","n","mash","data","toString","charCodeAt","h","version","s0","s1","s2","c","Date","random","t","uint32","fract53","args","AleaRandomGenerator","alea","crypto","numerator","Number","parseInt","numBytes","ceil","bytes","randomBytes","e","pseudoRandomBytes","substring","height","window","innerHeight","document","documentElement","clientHeight","body","width","innerWidth","clientWidth","agent","navigator","userAgent","createAleaGenerator","generator","createWithSeeds","insecure","createAleaGeneratorWithGeneratedSeed"],"mappings":"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","file":"/packages/random.js","sourcesContent":["// We use cryptographically strong PRNGs (crypto.getRandomBytes())\n// When using crypto.getRandomValues(), our primitive is hexString(),\n// from which we construct fraction().\n\nimport NodeRandomGenerator from './NodeRandomGenerator';\nimport createRandom from './createRandom';\n\nexport const Random = createRandom(new NodeRandomGenerator());\n","// We use cryptographically strong PRNGs (crypto.getRandomBytes() on the server,\n// window.crypto.getRandomValues() in the browser) when available. If these\n// PRNGs fail, we fall back to the Alea PRNG, which is not cryptographically\n// strong, and we seed it with various sources such as the date, Math.random,\n// and window size on the client.  When using crypto.getRandomValues(), our\n// primitive is hexString(), from which we construct fraction(). When using\n// window.crypto.getRandomValues() or alea, the primitive is fraction and we use\n// that to construct hex string.\n\nimport { Meteor } from 'meteor/meteor';\n\nconst UNMISTAKABLE_CHARS = '23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz';\nconst BASE64_CHARS = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ' +\n  '0123456789-_';\n\n// `type` is one of `RandomGenerator.Type` as defined below.\n//\n// options:\n// - seeds: (required, only for RandomGenerator.Type.ALEA) an array\n//   whose items will be `toString`ed and used as the seed to the Alea\n//   algorithm\nexport default class RandomGenerator {\n\n  /**\n   * @name Random.fraction\n   * @summary Return a number between 0 and 1, like `Math.random`.\n   * @locus Anywhere\n   */\n  fraction () {\n    throw new Error(`Unknown random generator type`);\n  }\n\n  /**\n   * @name Random.hexString\n   * @summary Return a random string of `n` hexadecimal digits.\n   * @locus Anywhere\n   * @param {Number} n Length of the string\n   */\n  hexString (digits) {\n    return this._randomString(digits, '0123456789abcdef');\n  }\n\n  _randomString (charsCount, alphabet) {\n    let result = '';\n    for (let i = 0; i < charsCount; i++) {\t\n      result += this.choice(alphabet);\n    }\n    return result;\n  }\n\n  /**\n   * @name Random.id\n   * @summary Return a unique identifier, such as `\"Jjwjg6gouWLXhMGKW\"`, that is\n   * likely to be unique in the whole world.\n   * @locus Anywhere\n   * @param {Number} [n] Optional length of the identifier in characters\n   *   (defaults to 17)\n   */\n  id (charsCount) {\n    // 17 characters is around 96 bits of entropy, which is the amount of\n    // state in the Alea PRNG.\n    if (charsCount === undefined) {\n      charsCount = 17;\n    }\n\n    return this._randomString(charsCount, UNMISTAKABLE_CHARS);\n  }\n\n  /**\n   * @name Random.secret\n   * @summary Return a random string of printable characters with 6 bits of\n   * entropy per character. Use `Random.secret` for security-critical secrets\n   * that are intended for machine, rather than human, consumption.\n   * @locus Anywhere\n   * @param {Number} [n] Optional length of the secret string (defaults to 43\n   *   characters, or 256 bits of entropy)\n   */\n  secret (charsCount) {\n    // Default to 256 bits of entropy, or 43 characters at 6 bits per\n    // character.\n    if (charsCount === undefined) {\n      charsCount = 43;\n    }\n\n    return this._randomString(charsCount, BASE64_CHARS);\n  }\n\n  /**\n   * @name Random.choice\n   * @summary Return a random element of the given array or string.\n   * @locus Anywhere\n   * @param {Array|String} arrayOrString Array or string to choose from\n   */\n  choice (arrayOrString) {\n    const index = Math.floor(this.fraction() * arrayOrString.length);\n    if (typeof arrayOrString === 'string') {\n      return arrayOrString.substr(index, 1);\n    }\n    return arrayOrString[index];\n  }\n}\n","import RandomGenerator from './AbstractRandomGenerator';\n\n// Alea PRNG, which is not cryptographically strong\n// see http://baagoe.org/en/wiki/Better_random_numbers_for_javascript\n// for a full discussion and Alea implementation.\nfunction Alea(seeds) {\n  function Mash() {\n    let n = 0xefc8249d;\n\n    const mash = (data) => {\n      data = data.toString();\n      for (let i = 0; i < data.length; i++) {\n        n += data.charCodeAt(i);\n        let h = 0.02519603282416938 * n;\n        n = h >>> 0;\n        h -= n;\n        h *= n;\n        n = h >>> 0;\n        h -= n;\n        n += h * 0x100000000; // 2^32\n      }\n      return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n    };\n\n    mash.version = 'Mash 0.9';\n    return mash;\n  }\n\n  let s0 = 0;\n  let s1 = 0;\n  let s2 = 0;\n  let c = 1;\n  if (seeds.length === 0) {\n    seeds = [+new Date];\n  }\n  let mash = Mash();\n  s0 = mash(' ');\n  s1 = mash(' ');\n  s2 = mash(' ');\n\n  for (let i = 0; i < seeds.length; i++) {\n    s0 -= mash(seeds[i]);\n    if (s0 < 0) {\n      s0 += 1;\n    }\n    s1 -= mash(seeds[i]);\n    if (s1 < 0) {\n      s1 += 1;\n    }\n    s2 -= mash(seeds[i]);\n    if (s2 < 0) {\n      s2 += 1;\n    }\n  }\n  mash = null;\n\n  const random = () => {\n    const t = (2091639 * s0) + (c * 2.3283064365386963e-10); // 2^-32\n    s0 = s1;\n    s1 = s2;\n    return s2 = t - (c = t | 0);\n  };\n\n  random.uint32 = () => random() * 0x100000000; // 2^32\n  random.fract53 = () => random() +\n        ((random() * 0x200000 | 0) * 1.1102230246251565e-16); // 2^-53\n\n  random.version = 'Alea 0.9';\n  random.args = seeds;\n  return random;\n}\n\n// options:\n// - seeds: an array\n//   whose items will be `toString`ed and used as the seed to the Alea\n//   algorithm\nexport default class AleaRandomGenerator extends RandomGenerator {\n  constructor ({ seeds = [] } = {}) {\n    super();\n    if (!seeds) {\n      throw new Error('No seeds were provided for Alea PRNG');\n    }\n    this.alea = Alea(seeds);\n  }\n\n  /**\n   * @name Random.fraction\n   * @summary Return a number between 0 and 1, like `Math.random`.\n   * @locus Anywhere\n   */\n  fraction () {\n    return this.alea();\n  }\n}\n","import crypto from 'crypto';\nimport RandomGenerator from './AbstractRandomGenerator';\n\nexport default class NodeRandomGenerator extends RandomGenerator {\n  /**\n   * @name Random.fraction\n   * @summary Return a number between 0 and 1, like `Math.random`.\n   * @locus Anywhere\n   */\n  fraction () {\n    const numerator = Number.parseInt(this.hexString(8), 16);\n    return numerator * 2.3283064365386963e-10; // 2^-3;\n  }\n\n  /**\n   * @name Random.hexString\n   * @summary Return a random string of `n` hexadecimal digits.\n   * @locus Anywhere\n   * @param {Number} n Length of the string\n   */\n  hexString (digits) {\n    const numBytes = Math.ceil(digits / 2);\n    let bytes;\n    // Try to get cryptographically strong randomness. Fall back to\n    // non-cryptographically strong if not available.\n    try {\n      bytes = crypto.randomBytes(numBytes);\n    } catch (e) {\n      // XXX should re-throw any error except insufficient entropy\n      bytes = crypto.pseudoRandomBytes(numBytes);\n    }\n    const result = bytes.toString('hex');\n    // If the number of digits is odd, we'll have generated an extra 4 bits\n    // of randomness, so we need to trim the last digit.\n    return result.substring(0, digits);\n  }\n}\n","import AleaRandomGenerator from './AleaRandomGenerator';\n\n// instantiate RNG.  Heuristically collect entropy from various sources when a\n// cryptographic PRNG isn't available.\n\n// client sources\nconst height = (typeof window !== 'undefined' && window.innerHeight) ||\n      (typeof document !== 'undefined'\n       && document.documentElement\n       && document.documentElement.clientHeight) ||\n      (typeof document !== 'undefined'\n       && document.body\n       && document.body.clientHeight) ||\n      1;\n\nconst width = (typeof window !== 'undefined' && window.innerWidth) ||\n      (typeof document !== 'undefined'\n       && document.documentElement\n       && document.documentElement.clientWidth) ||\n      (typeof document !== 'undefined'\n       && document.body\n       && document.body.clientWidth) ||\n      1;\n\nconst agent = (typeof navigator !== 'undefined' && navigator.userAgent) || '';\n\nexport default function createAleaGenerator() {\n  return new AleaRandomGenerator({\n    seeds: [new Date, height, width, agent, Math.random()],\n  });\n}\n","import AleaRandomGenerator from './AleaRandomGenerator'\nimport createAleaGeneratorWithGeneratedSeed from './createAleaGenerator';\n\nexport default function createRandom(generator) {\n  // Create a non-cryptographically secure PRNG with a given seed (using\n  // the Alea algorithm)\n  generator.createWithSeeds = (...seeds) => {\n    if (seeds.length === 0) {\n      throw new Error('No seeds were provided');\n    }\n    return new AleaRandomGenerator({ seeds });\n  };\n\n  // Used like `Random`, but much faster and not cryptographically\n  // secure\n  generator.insecure = createAleaGeneratorWithGeneratedSeed();\n\n  return generator;\n}\n"]}