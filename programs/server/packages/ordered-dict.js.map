{"version":3,"sources":["meteor://ðŸ’»app/packages/ordered-dict/ordered_dict.js"],"names":["element","key","value","next","prev","OrderedDict","_k","_stringify","empty","_first","size","_size","_linkEltIn","elt","_last","_linkEltOut","putBefore","item","before","_dict","Error","append","remove","get","has","Object","prototype","hasOwnProperty","call","forEach","iter","context","i","b","BREAK","forEachAsync","asyncIter","first","firstValue","last","lastValue","moveBefore","eltBefore","indexOf","ret","v","k","_checkRep","keys","args","create","shift","x","kv"],"mappings":"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","file":"/packages/ordered-dict.js","sourcesContent":["// This file defines an ordered dictionary abstraction that is useful for\n// maintaining a dataset backed by observeChanges.  It supports ordering items\n// by specifying the item they now come before.\n\n// The implementation is a dictionary that contains nodes of a doubly-linked\n// list as its values.\n\n// constructs a new element struct\n// next and prev are whole elements, not keys.\nfunction element(key, value, next, prev) {\n  return {\n    key: key,\n    value: value,\n    next: next,\n    prev: prev\n  };\n}\n\nexport class OrderedDict {\n  constructor(...args) {\n    this._dict = Object.create(null);\n    this._first = null;\n    this._last = null;\n    this._size = 0;\n\n    if (typeof args[0] === 'function') {\n      this._stringify = args.shift();\n    } else {\n      this._stringify = function (x) { return x; };\n    }\n\n    args.forEach(kv => this.putBefore(kv[0], kv[1], null));\n  }\n\n  // the \"prefix keys with a space\" thing comes from here\n  // https://github.com/documentcloud/underscore/issues/376#issuecomment-2815649\n  _k(key) {\n    return \" \" + this._stringify(key);\n  }\n\n  empty() {\n    return !this._first;\n  }\n\n  size() {\n    return this._size;\n  }\n\n  _linkEltIn(elt) {\n    if (!elt.next) {\n      elt.prev = this._last;\n      if (this._last)\n        this._last.next = elt;\n      this._last = elt;\n    } else {\n      elt.prev = elt.next.prev;\n      elt.next.prev = elt;\n      if (elt.prev)\n        elt.prev.next = elt;\n    }\n    if (this._first === null || this._first === elt.next)\n      this._first = elt;\n  }\n\n  _linkEltOut(elt) {\n    if (elt.next)\n      elt.next.prev = elt.prev;\n    if (elt.prev)\n      elt.prev.next = elt.next;\n    if (elt === this._last)\n      this._last = elt.prev;\n    if (elt === this._first)\n      this._first = elt.next;\n  }\n\n  putBefore(key, item, before) {\n    if (this._dict[this._k(key)])\n      throw new Error(\"Item \" + key + \" already present in OrderedDict\");\n    var elt = before ?\n      element(key, item, this._dict[this._k(before)]) :\n      element(key, item, null);\n    if (typeof elt.next === \"undefined\")\n      throw new Error(\"could not find item to put this one before\");\n    this._linkEltIn(elt);\n    this._dict[this._k(key)] = elt;\n    this._size++;\n  }\n\n  append(key, item) {\n    this.putBefore(key, item, null);\n  }\n\n  remove(key) {\n    var elt = this._dict[this._k(key)];\n    if (typeof elt === \"undefined\")\n      throw new Error(\"Item \" + key + \" not present in OrderedDict\");\n    this._linkEltOut(elt);\n    this._size--;\n    delete this._dict[this._k(key)];\n    return elt.value;\n  }\n\n  get(key) {\n    if (this.has(key)) {\n      return this._dict[this._k(key)].value;\n    }\n  }\n\n  has(key) {\n    return Object.prototype.hasOwnProperty.call(\n      this._dict,\n      this._k(key)\n    );\n  }\n\n  // Iterate through the items in this dictionary in order, calling\n  // iter(value, key, index) on each one.\n\n  // Stops whenever iter returns OrderedDict.BREAK, or after the last element.\n  forEach(iter, context = null) {\n    var i = 0;\n    var elt = this._first;\n    while (elt !== null) {\n      var b = iter.call(context, elt.value, elt.key, i);\n      if (b === OrderedDict.BREAK) return;\n      elt = elt.next;\n      i++;\n    }\n  }\n\n  async forEachAsync(asyncIter, context = null) {\n    let i = 0;\n    let elt = this._first;\n    while (elt !== null) {\n      const b = await asyncIter.call(context, elt.value, elt.key, i);\n      if (b === OrderedDict.BREAK) return;\n      elt = elt.next;\n      i++;\n    }\n  }\n\n  first() {\n    if (this.empty()) {\n      return;\n    }\n    return this._first.key;\n  }\n\n  firstValue() {\n    if (this.empty()) {\n      return;\n    }\n    return this._first.value;\n  }\n\n  last() {\n    if (this.empty()) {\n      return;\n    }\n    return this._last.key;\n  }\n\n  lastValue() {\n    if (this.empty()) {\n      return;\n    }\n    return this._last.value;\n  }\n\n  prev(key) {\n    if (this.has(key)) {\n      var elt = this._dict[this._k(key)];\n      if (elt.prev)\n        return elt.prev.key;\n    }\n    return null;\n  }\n\n  next(key) {\n    if (this.has(key)) {\n      var elt = this._dict[this._k(key)];\n      if (elt.next)\n        return elt.next.key;\n    }\n    return null;\n  }\n\n  moveBefore(key, before) {\n    var elt = this._dict[this._k(key)];\n    var eltBefore = before ? this._dict[this._k(before)] : null;\n    if (typeof elt === \"undefined\") {\n      throw new Error(\"Item to move is not present\");\n    }\n    if (typeof eltBefore === \"undefined\") {\n      throw new Error(\"Could not find element to move this one before\");\n    }\n    if (eltBefore === elt.next) // no moving necessary\n      return;\n    // remove from its old place\n    this._linkEltOut(elt);\n    // patch into its new place\n    elt.next = eltBefore;\n    this._linkEltIn(elt);\n  }\n\n  // Linear, sadly.\n  indexOf(key) {\n    var ret = null;\n    this.forEach((v, k, i) => {\n      if (this._k(k) === this._k(key)) {\n        ret = i;\n        return OrderedDict.BREAK;\n      }\n      return;\n    });\n    return ret;\n  }\n\n  _checkRep() {\n    Object.keys(this._dict).forEach(k => {\n      const v = this._dict[k];\n      if (v.next === v) {\n        throw new Error(\"Next is a loop\");\n      }\n      if (v.prev === v) {\n        throw new Error(\"Prev is a loop\");\n      }\n    });\n  }\n}\n\nOrderedDict.BREAK = {\"break\": true};\n"]}